<!DOCTYPE html>
<html lang="en">
  
  <head>
    <meta charset="utf-8">
    <title>
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style type="text/css">
      html { height: 100% }
      #map_canvas { height: 100% }
    </style>
    <meta name="author" content="">
    <!-- Le styles -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <style>
      body { padding-top: 60px; /* 60px to make the container go all the way
      to the bottom of the topbar */ }
    </style>
    <link href="assets/css/bootstrap-responsive.css" rel="stylesheet">
    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js">
      </script>
    <![endif]-->
    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="assets/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-57-precomposed.png">
    <style>
      undefined
    </style>
<style type="text/css">
#map_canvas { height: 500px;
              width:700px }
</style>
<script type="text/javascript"
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD-g7B8YM-P9qNRSPLXBw-mecrP-hKIhIM&sensor=false">
</script>
<script type="text/javascript">
function initialize() {

    var mapOptions = {
center: new google.maps.LatLng(-34.397, 150.644),
        zoom: 8,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var map = new google.maps.Map(document.getElementById("map_canvas"),
            mapOptions);


}
</script>
  </head>
  
<body onload="initialize()">
    <div class="navbar navbar-fixed-top navbar-inverse">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar">
            </span>
            <span class="icon-bar">
            </span>
            <span class="icon-bar">
            </span>
          </a>
          <a class="brand" href="#">
            Project name
          </a>
          <div class="nav-collapse">
            <ul class="nav">
              <li>
                <a href="#">
                  Home
                </a>
              </li>
              <li>
                <a href="#">
                  About
                </a>
              </li>
              <li>
                <a href="#">
                  Contact
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span3">
          <div class="well sidebar-nav">
            <ul class="nav nav-list">
              <li class="nav-header">
                Header
              </li>
              <li>
              </li>
              <li class="">
                <a href="#">
                  Link
                </a>
              </li>
              <li class="">
                <a href="#">
                  Link
                </a>
              </li>
              <li class="">
                <a href="#">
                  Link
                </a>
              </li>
            </ul>
          </div>
        </div>
        <div class="span9">
          <div class="hero-unit">
            <div>
              <h1>
                Hello CleanWeb!
              </h1>
              <p>
                Sense the data!
                <br>
              </p>
            </div>
            <a class="btn btn-primary" href="#" >
              Learn more »
            </a>
          </div>
          <div class="row-fluid">
          </div>
          <div class="row-fluid">
            <a class="btn" href="#">
              GetData
            </a>
            <div id="dataIn">
              <p>
                Content
        <span id="datastream-value"></span>
        <span id="feed-list"></span>
    <input type="button" value="newFeed" onclick="javascript:createNewFeed()"/>
    <input type="button" value="listFeed" onclick="javascript:getFeedList()"/>
    <input type="button" value="updateFeed" onclick="javascript:updateFeed()"/>
    <input type="button" value="historialFeed" onclick="javascript:getHistoricalFeed()"/>
    <input type="button" value="drawFeed" onclick="javascript:drawFeed(histFeed,'2')"/>


              </p>
<div id="map_canvas" ></div>
<script type="text/javascript" src="http://tile.cloudmade.com/wml/0.2/web-maps-lite.js"></script><script type="text/javascript" src="http://apps.pachube.com/trails/trails.js"></script><script type="text/javascript">createPachubeTrails(1963,0,1,2,500,500);</script>
            </div>
          </div>
          <hr>
          <div>
            © BreathIn 2012
          </div>
        </div>
      </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js">
    </script>
    <script src="assets/js/bootstrap.js">
    </script>
      <script src="assets/js/cosmjs-1.0.0.min.js">
      </script>

      <script type="text/javascript">
    var json_feed_file = 'feedCreation.json';
    cosm.setKey("bG6AVQou1cNpqkVK1PCuHY1aTISSAKxHdVZBVzVLQlgrMD0g");
    var feedDef;
    $.get(json_feed_file, function(data) {
        feedDef = data;
    });
    //var json_feed_file = 'feedCreation.json';
    //$('#datastream-value').cosm('get', { feed: feedId , datastream: '0' });  
//    cosm.feed.get (feedId, function (data) {
//        feedDef = data;
//    });

    function createNewFeed(){
        return cosm.feed.new(feedDef,function (data) {
                return data;
        });
    }
    var feedList = new Array();
    
    function getFeedList(){
        cosm.feed.list ({"user":"chudichudi"}, function (data) {
                    //alert(            data );
                    feedList = [];
                    for(var i = 0; i < data['totalResults']; i++){
                    //$.each(data['results'], function (feeds){
                        feedList.push( data['results'][i]['id']) ;
                    //});
                    }
                    //feedList = data['results'][0]['id'];
                    $('#datastream-value').text(feedList);
                    return data;
            });
    }
    var feedId =  '89392';
    function updateFeed(feedId){
        var newLoc = {"title":"BreathInSensor","location":{
          "disposition":"mobile",
          "ele":"0.0",
          "lat":1.0,
          "lon":1.0,
          "domain":"physical"
          }}; 
       cosm.feed.update(feedId,newLoc,function(data){
        }) ;
    }


    var histFeed;
    function getHistoricalFeed(){
        cosm.feed.history (1963, {"duration":"100000seconds"}, function (data) {
            histFeed = data;
        });

    }
    
    function getRGB(min, max, value){
        var red =  (255*value-255*min)/(max-min);
        var green =  (255*value-255*max)/(min-max);
        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }
        return rgbToHex(red, green,0);

    } 
   
    function drawFeed(feedH, datastreamId){

      var myLatLng = new google.maps.LatLng(0, -180);
      var mapOptions = {
        zoom: 3,
        center: myLatLng,
        mapTypeId: google.maps.MapTypeId.TERRAIN
      };


      function getDatapointValue(feedH, atTime, datastrId){
            var toRet;
            var datastreams = feedH.datastreams;
            //position of correct data stream
            var dataSNum;
            for( var dataS in datastreams){
                if(datastreams[dataS].id == datastrId){
                    dataSNum = dataS;
                }
            }
            var datapoints = datastreams[dataSNum]['datapoints'];
            for(var dataP in datapoints){
                if(datapoints[dataP].at == atTime ){
                    toRet = datapoints[dataP].value;
                }
            }
            return toRet;
      }

      var minTemp = 5;
      var maxTemp = 25;

      var minHum = 10;
      var maxHum = 50;  

      var minUfo = -10;
      var maxUfo = 0;  
    
      var map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
            var routeCoors = [];
            //alert(feedH.location.waypoints[0].lat);
            var waypointToSort = feedH.location.waypoints;
            for(var ways in waypointToSort){
                console.log(waypointToSort[ways].lat);
                console.log(waypointToSort[ways].lon);
            }
            waypointToSort = waypointToSort.sort(function(a, b) {
                 console.log(a['at']);
                 console.log(b['at']);
                 console.log(a['at'] > b['at']);
                 return (a['at'] > b['at']);
                
            });
            for(var ways in waypointToSort){
                var lat = waypointToSort[ways].lat;
                var lon = waypointToSort[ways].lon;
                var at = waypointToSort[ways].at;
                console.log(lat);
                console.log(lon);
                console.log()
                console.log(ways);
                if(typeof lon === 'undefined' || typeof lat === 'undefined'){
                }else{
                    //found lat and long
                    var pos = new google.maps.LatLng(lat, lon);
                    routeCoors.push(pos) ;
                    var dpValue = getDatapointValue(feedH, at, datastreamId);
                    var dpRGB = getRGB(minUfo, maxUfo, dpValue);
                    var circleOptions = {
                        strokeColor: dpRGB,
                        strokeOpacity: 0.8,
                        strokeWeight: 2,
                        fillColor: dpRGB,
                        fillOpacity: 0.35,
                        map: map,
                        center: pos,
                        radius: 70000 
                    };
                    circleMeasure = new google.maps.Circle(circleOptions);
                    
                }            
            }
              var routePoly = new google.maps.Polyline({
                path: routeCoors,
                strokeColor: "#FF0000",
                strokeOpacity: 1.0,
                strokeWeight: 2
              });

              routePoly.setMap(map);
    }




      </script>

  </body>

</html>
